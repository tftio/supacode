#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat <<'USAGE'
Usage:
  osc-notify [osc9|osc9-4|osc777|both] [args]

Commands:
  osc9 [body]
  osc9-4 [state] [progress]
  osc777 [title] [body]
  both [osc9_body] [title] [osc777_body]

OSC 9;4 states:
  0 remove
  1 set
  2 error
  3 indeterminate
  4 pause

Defaults:
  osc9 body:    Hello from OSC 9
  osc9-4 state: 1
  osc9-4 progress: 0
  osc777 title: Title
  osc777 body:  Body
USAGE
}

command=${1:-both}

case "$command" in
  osc9)
    body=${2:-"Hello from OSC 9"}
    printf '\033]9;%s\a' "$body"
    ;;
  osc9-4)
    state=${2:-"1"}
    progress=${3:-"0"}
    printf '\033]9;4;%s;%s\a' "$state" "$progress"
    ;;
  osc777)
    title=${2:-"Title"}
    body=${3:-"Body"}
    printf '\033]777;notify;%s;%s\a' "$title" "$body"
    ;;
  both)
    osc9_body=${2:-"Hello from OSC 9"}
    title=${3:-"Title"}
    osc777_body=${4:-"Body"}
    printf '\033]9;%s\a' "$osc9_body"
    printf '\033]777;notify;%s;%s\a' "$title" "$osc777_body"
    ;;
  help|-h|--help)
    usage
    ;;
  *)
    usage >&2
    exit 1
    ;;
esac
